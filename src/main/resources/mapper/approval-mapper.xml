<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Approval">
        <select id="login" resultType="Long">
                select emp_id from t_emp where mbl_tel_no = "#{mbl_tel_no}"
        </select>
        <select id="list" resultType="map" parameterType="map">
                SELECT docid, empid, title, contents, contents_text, create_date
                FROM t_approval_document WHERE 1=1
                <if test="startDate != null">
                        <if test="startDate != ''">
                                AND create_date <![CDATA[>=]]> '${startDate}'
                        </if>
                </if>
                <if test="endDate != null">
                        <if test="endDate != ''">
                                AND create_date <![CDATA[<=]]> '${endDate}'
                        </if>
                </if>
                <if test="search != null">
                        <if test="search != ''">
                                AND (title LIKE '%${search}%' OR contents_text LIKE '%${search}%')
                        </if>
                </if>
                order by create_date desc
        </select>
        <select id="view" resultType="view" parameterType="Long">
                SELECT e.emp_nm, d.docid, d.empid, d.title, d.contents, d.contents_text, FORMAT(d.create_date, 'yyyy-MM-dd H:m:s') as create_date, d.reference_docid
                FROM t_approval_document as d
                LEFT OUTER JOIN t_emp as e ON d.empid = e.emp_id
                WHERE d.docid = ${id}
        </select>
        <select id="chat" resultType="chat" parameterType="Long">
                SELECT * FROM t_approval_document_chat WHERE docid = ${id}
        </select>
</mapper>